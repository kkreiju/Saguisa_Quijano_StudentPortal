@{
	ViewData["Title"] = "Schedule Edit";
}

@model StudentPortal.Models.Entities.Schedules

<h1>Schedule Edit</h1>

@if (Model is null)
{
	@if (ViewBag.Message == "EDP Code Not Found." && ViewBag.Search == true)
	{
		<div class="alert alert-danger mt-2">
			<p class="my-0">@ViewBag.Message</p>
		</div>
	}
	<form action="/Schedules/Edit" method="get" id="search">
		<label class="form-label">EDP Code</label>
		<input type="text" class="form-control shadow-lg" name="edpcode" id="edpcode" required />
		<button onclick="search()" class="btn btn-primary mt-2">Search</button>
	</form>
}
else
{
	@if (ViewBag.Message != null && ViewBag.Message.Contains("schedule"))
	{
		<div class="alert alert-danger mt-2">
			<p class="my-0">@ViewBag.Message</p>
		</div>
	}

	<form method="post" id="form">
		<input type="hidden" name="edpc" value="@ViewBag.EDP" />

		<div class="mt-3">
			<label class="form-label">EDP Code</label>
			<input type="number" class="form-control shadow-lg" name="edpcode" asp-for="EDPCode" required />
		</div>

		<div class="mt-3">
			<label class="form-label">Subject Code</label>
			<input type="text" style="text-transform: uppercase;" class="form-control shadow-lg" name="subjectcode" asp-for="SubjCode" maxlength="15" required />
		</div>

		<div class="row">
			<div class="col mt-3">
				<label class="form-label">Time Start</label>
				<input type="time" class="form-control shadow-lg" name="starttime" asp-for="StartTime" required />
			</div>

			<div class="col mt-3">
				<label class="form-label">Time End</label>
				<input type="time" class="form-control shadow-lg" name="endtime" asp-for="EndTime" required />
			</div>
		</div>

		<div class="mt-3" id="daysform">
			<legend>Days</legend>
			<div>
				<input class="form-check-input" type="checkbox" value="MON" id="monday" />
				<label class="form-check-label" for="monday">Monday</label>
			</div>
			<div>
				<input class="form-check-input" type="checkbox" value="TUE" id="tuesday" />
				<label class="form-check-label" for="tuesday">Tuesday</label>
			</div>
			<div>
				<input class="form-check-input" type="checkbox" value="WED" id="wednesday" />
				<label class="form-check-label" for="wednesday">Wednesday</label>
			</div>
			<div>
				<input class="form-check-input" type="checkbox" value="THU" id="thursday" />
				<label class="form-check-label" for="thursday">Thursday</label>
			</div>
			<div>
				<input class="form-check-input" type="checkbox" value="FRI" id="friday" />
				<label class="form-check-label" for="friday">Friday</label>
			</div>
			<div>
				<input class="form-check-input" type="checkbox" value="SAT" id="saturday" />
				<label class="form-check-label" for="saturday">Saturday</label>
			</div>

			<!-- Tooltip message (initially hidden) -->
			<div id="tooltipMessage" style="color: red; display: none; margin-top: 10px;">
				Please select at least one day.
			</div>
		</div>

		<!-- Hidden field to store concatenated values -->
		<input type="hidden" asp-for="Days" id="days" />

		<div class="mt-3">
			<label class="form-label">Room</label>
			<input type="text" style="text-transform: uppercase;" class="form-control shadow-lg" name="room" asp-for="Room" maxlength="5" required />
		</div>

		<div class="mt-3">
			<label class="form-label">Max Size</label>
			<input type="number" class="form-control shadow-lg" name="maxsize" asp-for="MaxSize" required />
		</div>

		<div class="row">
			<div class="col mt-3">
				<label class="form-label">Course</label>
				<select id="course" name="course" class="form-select shadow-lg" asp-for="Course">
					<option value="BSIT">BSIT</option>
					<option value="BSIS">BSIS</option>
					<option value="BSN">BSN</option>
				</select>
			</div>

			<div class="col mt-3">
				<label class="form-label">Section</label>
				<input type="text" style="text-transform: uppercase;" class="form-control shadow-lg" name="section" asp-for="Section" maxlength="3" required />
			</div>
		</div>


		<div class="mt-3">
			<label class="form-label">Curriculum Year</label>
			<input type="text" style="text-transform: uppercase;" class="form-control shadow-lg" name="schoolyear" asp-for="SchoolYear" maxlength="10" required />
		</div>

		<div class="mt-3">
			<button type="submit" id="submitBtn" class="btn btn-primary">Save</button>
		</div>
	</form>
}

<script>
	const submitBtn = document.getElementById('submitBtn');
	const checkboxes = document.querySelectorAll('.form-check-input');
	const tooltipMessage = document.getElementById('tooltipMessage');

	// Add event listener for the submit button
	submitBtn.addEventListener('click', function (event) {
		// Check if any checkbox is selected
		let isAnyChecked = false;
		checkboxes.forEach(checkbox => {
			if (checkbox.checked) {
				isAnyChecked = true;
			}
		});

		// If no checkbox is checked, alert the user and prevent form submission
		if (!isAnyChecked) {
			tooltipMessage.style.display = 'block';
			daysform.scrollIntoView({
				behavior: 'smooth',  // Smooth scrolling
				block: 'start'       // Scroll to the top of the element
			});
			event.preventDefault(); // Prevent the form from submitting
		}
		else {
			tooltipMessage.style.display = 'none';
		}
	});

	function search() {
		document.getElementById('search').addEventListener('submit', function (event) {
			var edpcode = document.getElementById('edpcode').value;

			this.action = "/Schedules/Edit/" + encodeURIComponent(edpcode);
		});
	}

	// Concatenates days selected
	function updateSelectedDays() {
		const checkboxes = document.querySelectorAll('.form-check-input');
		const selectedDays = Array.from(checkboxes)
			.filter(checkbox => checkbox.checked)
			.map(checkbox => checkbox.value)
			.join(',');

		// Store the result in the hidden field
		document.getElementById('days').value = selectedDays;
	}

	// Add event listener to all checkboxes
	document.querySelectorAll('.form-check-input').forEach(checkbox => {
		checkbox.addEventListener('change', updateSelectedDays);
	});
</script>
